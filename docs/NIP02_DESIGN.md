# NIP-02 Suggested Design: Contact List Events for NostrSure

This document outlines a recommended design for supporting [NIP-02: Contact List and Petnames](https://github.com/nostr-protocol/nips/blob/master/02.md) in the NostrSure codebase.

## Overview

NIP-02 introduces a new event kind (kind 3) for contact lists, allowing users to publish lists of pubkeys they follow, optionally with petnames and relay hints.

## Requirements

- **Event kind 3**: Contact list event
- **Tags**: Each contact is represented by a `p` tag, with optional petname and relay URL
- **Content**: Free-form string (optional)
- **Pubkey**: The pubkey of the user publishing the contact list
- **Signature**: Event must be signed by the pubkey

## Data Model

### New Domain Entity

```csharp
public class ContactListEvent : NostrEvent
{
    public List<ContactEntry> Contacts { get; set; } = new();
}

public class ContactEntry
{
    public string Pubkey { get; set; } // 32-byte hex
    public string? Petname { get; set; }
    public string? RelayUrl { get; set; }
}
```

- Inherit from `NostrEvent` for serialization/signature compatibility
- Store contacts as a list of `ContactEntry` objects

## Serialization/Deserialization

- **Tags**: Each contact is a `p` tag: `["p", <pubkey>, <petname?>, <relay?>]`
- **Event kind**: Set to 3 for contact list events
- **Content**: Optional free-form string
- **Pubkey, Signature, Created_at**: As per NIP-01
- Update `NostrEventJsonConverter` to support kind 3 events and parse/serialize `p` tags into `ContactEntry` objects

## Validation

- Ensure all `p` tags have valid 32-byte hex pubkeys
- Petname and relay URL are optional, but if present, must be strings
- Signature and event ID validation as per NIP-01

## CLI/Client Support

- Add CLI commands to:
  - Publish a contact list (kind 3 event)
  - Fetch and display a user's contact list
  - Optionally display petnames and relay hints
- Update subscription filters to support kind 3 events

## Example Event

```json
{
  "id": "...",
  "pubkey": "...",
  "created_at": 1680000000,
  "kind": 3,
  "tags": [
    ["p", "pubkey1", "Alice", "wss://relay.example.com"],
    ["p", "pubkey2", "Bob"]
  ],
  "content": "My contacts",
  "sig": "..."
}
```

## Suggested Implementation Steps

1. Add `ContactListEvent` and `ContactEntry` domain models
2. Update `NostrEventJsonConverter` to support kind 3 events and parse/serialize `p` tags
3. Add validation logic for contact list events
4. Add CLI commands for publishing and fetching contact lists
5. Add unit tests for contact list serialization, deserialization, and validation

## Extensibility

- Design allows for future NIP-02 extensions (e.g., petname resolution, relay prioritization)
- Compatible with existing NIP-01 event handling

---

Generated by GitHub Copilot on August 5, 2025
